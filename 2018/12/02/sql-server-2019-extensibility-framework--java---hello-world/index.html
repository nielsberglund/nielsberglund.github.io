<!DOCTYPE html>
<html lang="en">
    
    

    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.46" />

    
    
    

<title>SQL Server 2019 Extensibility Framework &amp; Java - Hello World • Niels Berglund</title>
<meta name="description" content="nielsb&#39;s blog :: technology musings about coding and data. Some topics: .NET, SQL Server, Data Science, R, Windows Azure and a lot more">
<meta name="keywords" content="sql server, c#, distributed computing, data science, microsoft r server, microsoft machine learning server, data science, sql server r services, sql server machine learning services, kafka, flink">
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SQL Server 2019 Extensibility Framework &amp; Java - Hello World"/>
<meta name="twitter:description" content="We look at how we install and enable Java extensions in SQL Server 2019, and a couple of simple Java methods."/>

<meta property="og:title" content="SQL Server 2019 Extensibility Framework &amp; Java - Hello World" />
<meta property="og:description" content="We look at how we install and enable Java extensions in SQL Server 2019, and a couple of simple Java methods." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2018/12/02/sql-server-2019-extensibility-framework--java---hello-world/" />



<meta property="article:published_time" content="2018-12-02T09:36:34&#43;02:00"/>

<meta property="article:modified_time" content="2018-12-02T09:36:34&#43;02:00"/>












    

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai.min.css">



<link rel="stylesheet" href="/css/hyde-hyde.css">
<link rel="stylesheet" href="/css/print.min.css" media="print">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

</head>


    <body >
        
<div class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="">Niels Berglund</a>
      </span>
      
      <p class="site__description">
         Technology musings about coding and data. Some topics: .NET, SQL Server, Data Science, R, Windows Azure and a lot more. 
      </p>
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:250px"
     data-ad-client="ca-pub-3005153158271538"
     data-ad-slot="7704601332"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>


      <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/">
						<span>Home</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/posts/">
						<span>Post Archive</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/series/">
						<span>Blog Post Series</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/categories/">
						<span>Categories</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tags/">
						<span>Tags</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/disclaimer/">
						<span>Disclaimer</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

    
      <img src="/images/MVP_Logo_large.png"/>

    </div>

      
    
    <p>
      <section class="social">
	<h3 style="color:#ffffff">Follow Me:</h3>
	<a href="http://feeds.feedburner.com/manageddata/"><i class="fas fa-rss"></i></a>
	
	&nbsp;<a href="https://twitter.com/nielsberglund"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	&nbsp;<a href="https://github.com/nberglund"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	&nbsp;<a href="https://linkedin.com/in/niels-berglund-0122593"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	&nbsp;<a href="https://stackoverflow.com/users/7656880"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
</section>

    </p>
    <p class="copyright">
      &copy; 2019 nielsb.
      <a href="https://creativecommons.org/licenses/by-sa/4.0">Some Rights Reserved</a>.
      
    </p>
  </div>
  <div>
  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1>SQL Server 2019 Extensibility Framework &amp; Java - Hello World</h1>
     
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Dec 2, 2018
    
    
    
      
      
          in
          
          
              <a class="post__category" href="/categories/sql-server-2019">SQL SERVER 2019</a>
              •
          
              <a class="post__category" href="/categories/sql-server-extensibility-framework">SQL SERVER EXTENSIBILITY FRAMEWORK</a>
              •
          
              <a class="post__category" href="/categories/sql-server-machine-learning-services">SQL SERVER MACHINE LEARNING SERVICES</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="post__tag" href="/tags/sql-server-2019">sql server 2019</a>
           
      
          <a class="post__tag" href="/tags/sql-server-machine-learning-services">sql server machine learning services</a>
           
      
          <a class="post__tag" href="/tags/r">r</a>
           
      
          <a class="post__tag" href="/tags/python">python</a>
           
      
          <a class="post__tag" href="/tags/java">java</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 16 min read
</div>


    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3005153158271538"
     data-ad-slot="6668073777"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  </header>
  <div class="post">
    <p>The SQL Server 2016 release introduced the <strong>SQL Server Extensibility Framework</strong> (EF), which gives us the ability to, from inside SQL Server, execute code in an external language runtime environment. SQL Server 2016 supports R as external runtime, and Microsoft added Python to supported runtimes in the SQL Server 2017 release. The important part about the EF is that the runtime is outside of the core database engine, but we call it from inside SQL Server via the stored procedure <code>sp_execute_external_script</code>. We can push data from SQL Server queries to the external runtime, and consume data, (resultsets, output parameters) from the external runtime back in SQL Server.</p>

<blockquote>
<p><strong>NOTE:</strong> You can read more about the actual implementation of the external runtimes and <code>sp_execute_external_script</code> in my <a href="/sql_server_2k16_r_services">SQL Server R Services Series</a> posts.</p>
</blockquote>

<p>In SQL Server 2019 Microsoft added the ability to execute custom Java code along the same lines we execute R and Python, and this blog post intends to give an introduction of how to install and enable the Java extension, as well as execute some very basic Java code. In future posts, I drill down how to pass data back and forth between SQL Server and Java.</p>

<p>To see what other posts there are in the series, go to <a href="/s2k19_ext_framework_java"><strong>SQL Server 2019 Extensibility Framework &amp; Java</strong></a>.</p>

<p></p>

<p>There may very well be future posts discussing how the internals differ between Java and R/Python, but I want to talk about that a little bit in this post as well, as it has an impact on how we write and call Java code.</p>

<h2 id="r-python-basics">R/Python Basics</h2>

<p>In my <a href="/sql_server_2k16_r_services">SQL Server R Services</a> series  talked about the components which make up <strong>SQL Server Machine Learning Services</strong>, and we saw how the flow when we execute an external script, looks something like so:</p>

<p><img src="/images/posts/sql_2k19_java_intro_flow1.png" alt="" /></p>

<p><strong>Figure 1:</strong> <em>Components &amp; Flow</em></p>

<p>We see in <em>Figure 1</em> what happens when we execute an R or Python script:</p>

<ul>
<li>Inside SQL Server we execute <code>sp_execute_external_script</code> and we send in the language as a parameter.</li>
<li>A connection happens to the <em>Launchpad</em> service and the service calls into an R or Python launcher (based on the <code>@language</code> parameter).</li>
<li>The launcher launches either the R or Python process.</li>
<li>Through a proprietary link dll, the <em>BxlServer</em> process gets launched.</li>
<li>In the process is the <code>SqlSatellite.dll</code> which handles data transfers.</li>
</ul>

<p>In the case of either R or Python, the execution of the script happens in the <em>BxlServer</em> process. A couple of things to keep in mind for later when we look at what we do when executing Java code:</p>

<ul>
<li>R/Python gets installed when we install SQL Server and choose In-Database machine learning. As R/Python is installed together with SQL Server, SQL gets implicit permissions to the R/Python exe&rsquo;s.</li>
<li>Even though we install open source versions of R/Python, they come together with proprietary dll&rsquo;s and exe&rsquo;s.</li>
<li>When we execute external scripts, we execute just that - scripts, and we pass in the code in the <code>sp_execute_external_script</code> call.</li>
</ul>

<p>Before we look at a how Java compares to the above, let us look at how we install and enable the Java extension.</p>

<h2 id="installing-java-extensions">Installing Java Extensions</h2>

<p>The way we install and enable Java on SQL Server differs depending on if you run SQL Server on Windows or Linux.</p>

<h4 id="windows">Windows</h4>

<p>You enable the ability to execute Java code, the same way as you do with R/Python. At install time, or when you add features, you check the <em>Machine Learning Services (In-Database)</em> checkbox:</p>

<p><img src="/images/posts/sql_2k19_java_intro_install1.png" alt="" /></p>

<p><strong>Figure 2:</strong> <em>Enable In-Database Machine Learning</em></p>

<p>In <em>Figure 2</em> we see how I have in the <em>Feature Selection</em> dialog checked the Machine Learning Services checkbox only. To enable Java, I do not need to choose either R or Python, the &ldquo;top-level&rdquo; <em>Machine Learning Services</em> is enough. Checking that, ensures that the required components, (<em>Launchpad</em>, and so on), gets installed.</p>

<blockquote>
<p><strong>NOTE:</strong> A future post covers the various components.</p>
</blockquote>

<p>When you install/add <em>Machine Learning Services</em> on Windows, you need to be aware that Java not gets installed. See below for more about that.</p>

<h4 id="linux">Linux</h4>

<p>When we install SQL Server on Linux, we do not have a &ldquo;nice&rdquo; UI, but we install via the shell. Similarly, when you want to install <em>Machine Learning Services</em> you do it via the shell. So to install only the Java extension you:</p>

<pre><code class="language-bash">sudo apt-get install mssql-server-extensibility-java
</code></pre>

<p><strong>Code Snippet 1:</strong> <em>Install Java Extension on Linux</em></p>

<p>In <em>Code Snippet 1</em> we see how I use the Ubuntu package manager to install the Java extension on an already installed <em>SQL Server on Linux</em> instance. Of course, you can install the instance as well as the Java extension in one go:</p>

<pre><code class="language-bash">sudo apt-get install mssql-server mssql-server-extensibility-java
</code></pre>

<p><strong>Code Snippet 2:</strong> <em>Install SQL Server and Java Extension Together</em></p>

<p>A difference between the install on Linux vs the Windows install is that on Linux Java 1.8.x gets installed if it is not already on the box.</p>

<h4 id="enabling-external-scripts">Enabling External Scripts</h4>

<p>On both Windows and Java we need to enable the execution of external scripts after installation:</p>

<pre><code class="language-sql">EXEC sp_configure 'external scripts enabled', 1
RECONFIGURE WITH OVERRIDE
</code></pre>

<p><strong>Code Snippet 3:</strong> <em>Enable External Scripts</em></p>

<p>You may remember that when we executed the code in <em>Code Snippet 3</em> in SQL Server 2016, and 2017 we had to restart the SQL Server instance afterwards to make the change &ldquo;stick&rdquo;. In SQL Server 2019 that is no longer necessary, (at least from CTP 2.1 and later), you just run the code and the setting changes!</p>

<h2 id="windows-and-java">Windows and Java</h2>

<p>When we run <code>mssql-server-extensibility-java</code> as in <em>Code Snippet 1</em> (or <em>Code Snippet 2</em>), I mentioned that Java 1.8.x gets installed if it is not already on the box. The installation also takes care of permissions as well as paths to the JVM. On Windows, this is not the case, so in this section, I talk a little bit about what you need to do if you are on Windows. More specifically we discuss Java versions, environment variables, and permissions.</p>

<blockquote>
<p><strong>NOTE:</strong> If you are on Linux have a look below where I mention <code>CLASSPATH.</code></p>
</blockquote>

<h4 id="java-version">Java Version</h4>

<p>As enabling <em>Machine Learning Services</em> does not install Java (on Windows), you need to ensure you already have a compatible version of Java on the box, or that you install one. On Windows, the suggestion for CTP 2.0 was version 1.10.x. However, Oracle no longer supports that Java version, so for CTP 2.1 the recommended version is 1.8.x, which is the same version recommended for SQL Server 2019 on Linux.</p>

<h4 id="environment-variables">Environment Variables</h4>

<p>When you do a typical installation of Java on Windows, you (or the installation program) also set some environment variables, so that applications can find the various Java dependencies:</p>

<ul>
<li>Set the <code>Path</code> environment variable to point to the <code>bin</code> directory of the JDK or JRE installation.</li>
<li>Create a <code>JAVA_HOME</code> environment variable pointing to the JDK/JRE top-level directory.</li>
</ul>

<p>When installing Java 1.8.x to use by <em>Machine Learning Services</em> you do not need the <code>JAVA_HOME</code> variable. However, other applications may need it, so I suggest you set it unless it is already set.</p>

<p>One crucial thing to be aware of is that the <code>Path</code> variable needs to be extended to include the directory where the <code>jvm.dll</code> exists. So, even if the <code>Path</code> includes the JDK/JRE <code>bin</code> directory, you need to edit the path to include the directory where the <code>jvm.dll</code> exists. The easiest way to do it (once again, this is Windows) is to use the UI: <strong>Control Panel-&gt;All Control Panel Items-&gt;System-&gt;Advanced System Setttings-&gt;Environment Variables-&gt;System Variables-&gt;Path-&gt;Edit</strong>:</p>

<p><img src="/images/posts/sql_2k19_java_intro_path.png" alt="" /></p>

<p><strong>Figure 3:</strong> <em>Set Path</em></p>

<p>We see in <em>Figure 3</em> how I in the <em>Edit environment variable</em> dialog:</p>

<ul>
<li>Click <em>New</em> (outlined in blue).</li>
<li>Add the path in the text box (highlighted in red).</li>
</ul>

<p>I then click <em>Ok</em> in the various screens to exit out of there.</p>

<p>So far in this section, the discussion has been around things related to Java on Windows. The next thing I want to mention is as equally relevant for Windows as for Linux, and it is the Java <code>CLASSPATH</code> environment variable.</p>

<p>Remember what I mentioned above; when we use R or Python in <em>Machine Learning Services</em> we send in the script to execute as a parameter in the call. For Java, we execute against compiled code, and somehow we need to let the external engine know where the code is. That is where the <code>CLASSPATH</code> variable comes in. The <code>CLASSPATH</code> variable is there so that the Java Compiler and Java Runtime can find Java classes referenced in your program. It maintains a list of directories (containing many Java class files) and JAR file (a single-file archive of Java classes).</p>

<p>To create the <code>CLASSPATH</code> variable on Windows I use the UI: <strong>Control Panel-&gt;All Control Panel Items-&gt;System-&gt;Advanced System Setttings-&gt;Environment Variables-&gt;System Variables</strong>, and click <em>New</em> in the <em>Environment Variables</em> dialog:</p>

<p><img src="/images/posts/sql_2k19_java_intro_classpathpath.png" alt="" /></p>

<p><strong>Figure 4:</strong> <em>Create CLASSPATH Windows</em></p>

<p>In <em>Figure 4</em>, after clicking <em>New</em>:</p>

<ul>
<li>I entered <code>CLASSPATH</code> in the <em>Variable name</em> text box (outlined in blue).</li>
<li>In the <em>Variable value</em> text box, (outlined in red), I entered the actual path where my compiled java code is located.</li>
</ul>

<p>If the <code>CLASSPATH</code> variable already exists, but you want your code in another location than where the variable points to, you can add a new path to the existing. In Windows, you delimit the paths with a semi-colon, and in Linux with a colon.</p>

<p>For completeness let us see how you create/set the <code>CLASSPATH</code> in Linux:</p>

<pre><code class="language-bash">export CLASSPATH=&quot;/path/to/directory:/path/to/directory2:$CLASSPATH&quot;
</code></pre>

<p><strong>Code Snippet 4:</strong> <em>Setting CLASSPATH in Linux</em></p>

<p>The code we see in <em>Code Snippet 4</em> adds two new directories to the existing <code>CLASSPATH</code> variable, delimited with colons.</p>

<blockquote>
<p><strong>NOTE:</strong> It is not absolutely necessary to have the <code>CLASSPATH</code> variable set. In <a href="/2018/12/30/sql-server-2019-extensibility-framework--java---misc.-stuff/">SQL Server 2019 Extensibility Framework &amp; Java - Misc. &lsquo;Stuff&rsquo;</a> we see how we can do without it.</p>
</blockquote>

<h4 id="permissions">Permissions</h4>

<p>The last thing we need to do is to set permissions on the <code>CLASSPATH</code> directory.</p>

<blockquote>
<p><strong>NOTE:</strong> The following is based on what I found using CTP 2.1. This may change in future releases.</p>
</blockquote>

<p>On Windows, right click on the directory(s) in the <code>CLASSPATH</code>, followed by <strong>Properties-&gt;Security</strong>, and you see something like so:</p>

<p><img src="/images/posts/sql_2k19_java_intro_classpathpath_sec1.png" alt="" /></p>

<p><strong>Figure 5:</strong> <em>Security Tab for CLASSPATH</em></p>

<p>In <em>Figure 5</em> we see how we are in the <em>Security</em> tab, and from here we can <strong>Edit-&gt;Add</strong> permissions, which gives us the ability to add permissions for users/groups:</p>

<p><img src="/images/posts/sql_2k19_java_intro_classpathpath_sec2.png" alt="" /></p>

<p><strong>Figure 6:</strong> <em>Security Tab for CLASSPATH</em></p>

<p>The group we want to add permissions for is <code>ALL APPLICATION PACKAGES</code>, as we see in <em>Figure 6</em>. Clicking <em>OK</em> allows us to assign the permissions needed:</p>

<p><img src="/images/posts/sql_2k19_java_intro_classpathpath_sec3.png" alt="" /></p>

<p><strong>Figure 7:</strong> <em>Security Tab for CLASSPATH</em></p>

<p>The required permission needed for <code>ALL APPLICATION PACKAGES</code> is <code>Read</code> as in <em>Figure 7</em>. After we click <em>OK</em> out of the dialogs, we are finally ready to write and execute code on Windows.</p>

<p>On Linux you need to give read and execute permissions on the <code>CLASSPATH</code> directory to the <code>mssql_satellite</code> user.</p>

<h2 id="java-code">Java Code</h2>

<p>There are certain things to think about when we write Java code which we want to call from SQL Server:</p>

<ul>
<li>We have no way, from calling from SQL Server to <code>new</code> &ldquo;up&rdquo; a class to get a reference to the class and call methods on that reference.</li>
<li>All methods called from SQL Server need to be <code>public static</code>. This is similar to SQLCLR. However, static methods can <code>new</code> &ldquo;up&rdquo; a class and call methods on the reference.</li>
<li>The static methods can not have a return type, they need to be <code>public static void</code>.</li>
<li>The methods must be parameterless!</li>
<li>No support for output parameters.</li>
</ul>

<p>The two first points above are probably not that too much of a hindrance, after all, this is the same as with SQLCLR. The last three, however, is more of a pain, and shortly we see how we work around the parameterless restriction.</p>

<p>So, let us write some code, and we start with &ldquo;Hello World&rdquo;:</p>

<pre><code class="language-java">public class JavaTest1{
  
  public static void helloWorld() {
    System.out.print(&quot;Hello World from SQL Java&quot;);
  }
}
</code></pre>

<p><strong>Code Snippet 5:</strong> <em>Java Hello World - I</em></p>

<p>In <em>Code Snippet 5</em> we see your typical &ldquo;Hello World&rdquo; Java application. Copy the code into a file and name the file <code>JavaTest1.java</code>. Then compile it into a <code>class</code> file:</p>

<pre><code class="language-bash">javac JavaTest1.java
</code></pre>

<p><strong>Code Snippet 6:</strong> <em>Compile Java Code</em></p>

<p>After executing the code in <em>Code Snippet 6</em>, copy the <code>class</code> file to the location of your <code>CLASSPATH</code> variable. When the <code>class</code> file is in the <code>CLASSPATH</code> directory, we try and call it from SQL:</p>

<pre><code class="language-sql">EXEC sp_execute_external_script 
                  @language = N'Java'
                , @script = N'JavaTest1.helloWorld'
</code></pre>

<p><strong>Code Snippet 7:</strong> <em>Execute Hello World</em></p>

<p>The only real difference we see in <em>Code Snippet 7</em> when executing Java code, compared to R/Python is that we call into the method we want to execute as opposed to send in the script.</p>

<blockquote>
<p><strong>NOTE:</strong> If you want a refresher about <code>sp_execute_external_script</code>, have a look at these three blog posts:</p>

<ul>
<li><a href="/2018/03/07/microsoft-sql-server-r-services---sp_execute_external_script---i/">Microsoft SQL Server R Services: sp_execute_external_script - I</a></li>
<li><a href="/2018/03/11/microsoft-sql-server-r-services---sp_execute_external_script---ii/">Microsoft SQL Server R Services - sp_execute_external_script - II</a></li>
<li><a href="/2018/03/21/microsoft-sql-server-r-services---sp_execute_external_script---iii/">Microsoft SQL Server R Services: sp_execute_external_script - III</a></li>
</ul>
</blockquote>

<p>So, the code in <em>Code Snippet 7</em> looks very straightforward, but when we execute, the result is this:</p>

<p><img src="/images/posts/sql_2k19_java_intro_error1.png" alt="" /></p>

<p><strong>Figure 8:</strong> <em>Execution Exception</em></p>

<p>Hmm, in <em>Figure 8</em> we see an exception about how we miss a member <code>numberOfOutputCols</code> in the class. What is this? So, in R/Python, there is a much &ldquo;tighter&rdquo; integration between SQL Server and the external runtime than between SQL Server and Java. Also, once again, with Java, we execute already compiled code whereas we in R/Python execute scripts. This all means that we don&rsquo;t have the same control over the runtime in Java, and we need to use &ldquo;magic&rdquo; variables to indicate to Java what we want to do. The <code>numberOfOutputCols</code> variable is such a variable, and the components that call into Java expects to find this variable. In this case, the variable is not there, so, therefore, the exception. However, take a look at the exception. Before the <code>Error: ...</code>, we do see the output from <code>System.out.print</code>, so all is not lost :).</p>

<blockquote>
<p><strong>NOTE:</strong> As I mentioned above, in future blog posts I cover the various components that make the Java integration work.</p>
</blockquote>

<h4 id="numberofoutputcols">numberOfOutputCols</h4>

<p>Above I said that <code>numberOfOutputCols</code> is a &ldquo;magic&rdquo; variable and that there are others as well. In future posts we cover the others, here we look at what <code>numberOfOutputCols</code> does.</p>

<p>First, all the &ldquo;magic&rdquo; variables have to do with passing of data between SQL Server and Java, and <code>numberOfOutputCols</code> indicates the number of columns you return to the calling code. In our code in <em>Code Snippet 5</em> we do not return anything, but the variable is still expected to be there. So, let us change the code slightly:</p>

<pre><code class="language-java">public class JavaTest1{
  public static short numberOfOutputCols;
  public static void helloWorld() {
    System.out.print(&quot;Hello World from SQL Java&quot;);
  }
}
</code></pre>

<p><strong>Code Snippet 8:</strong> <em>Java Hello World - II</em></p>

<p>In <em>Code Snippet 8</em> I added <code>numberOfOutputCols</code> as a class member. I recompile the code and copy the <code>class</code> file to <code>CLASSPATH</code>, and when I execute as in <em>Code Snippet 7</em>, all works! Yes, I have successfully executed my first Java application from inside SQL Server.</p>

<blockquote>
<p><strong>NOTE:</strong> The <code>numberOfOutputCols</code> variables has to be declared as <code>public static</code> and <code>short</code> as data type. Any other data type, and you get an exception.</p>
</blockquote>

<p>That was easy, what about something slightly more complicated, like a method expecting parameters?</p>

<h4 id="method-parameters">Method Parameters</h4>

<p>We want to add some basic calculator capabilities to our <code>JavaTest1</code> class because it is almost a law that after the obligatory &ldquo;Hello World&rdquo; application we need to write an adder method :). A typical Java <code>adder</code> method might look like so:</p>

<pre><code class="language-java">public static int adder(int x, int y) {
  return x + y;
}
</code></pre>

<p><strong>Code Snippet 9:</strong> <em>Java Adder</em></p>

<p>The problem with the code above, (if we want to use it from SQL Server), is twofold:</p>

<ul>
<li>It expects parameters to be passed in to the <code>adder</code> method.</li>
<li>It has a return type (<code>int</code>).</li>
</ul>

<p>So how do we turn the code in <em>Code Snippet 9</em> into something we can execute from SQL Server?</p>

<p>We need to figure out what to do with the parameters (<code>x</code> and <code>y</code>), and the return type. The parameters cannot be parameters in the method, but potentially variables in the class. As for the return type, for now, we just print the result:</p>

<pre><code class="language-java">public class JavaTest1 {
  public static short numberOfOutputCols;
  public static int x;
  public static int y;

  public static void adder() {
    System.out.printf(&quot;The result of adding %d and %d = %d&quot;, x, y, x + y);   
  }

  public static void helloWorld() {
    System.out.print(&quot;Hello World from SQL Java&quot;);
  }

}
</code></pre>

<p><strong>Code Snippet 10:</strong> <em>Java Adder Using Class Variables</em></p>

<p>The code in <em>Code Snippet 10</em>, looks like it should work, so recompile and place the compiled code in <code>CLASSPATH</code>. We can now execute, but the question is how we pass in the parameters, and how the Java code knows what they are?</p>

<p>In <a href="/2018/03/11/microsoft-sql-server-r-services---sp_execute_external_script---ii/">Microsoft SQL Server R Services - sp_execute_external_script - II</a> I wrote about parameters for scripts when we execute <code>sp_execute_external_script</code>:</p>

<ul>
<li>For parameters in R/Python scripts we declare them in SQL appending <code>@</code> to the R/Python name.</li>
<li>We define the SQL parameters in <code>sp_execute_external_script</code>&rsquo;s <code>@params</code> parameter.</li>
<li>We add the SQL parameters as named parameters in <code>sp_execute_external_script</code>.</li>
</ul>

<p>For Java code we do the same, so the SQL code looks something like so:</p>

<pre><code class="language-sql">DECLARE @p1 int = 21;
DECLARE @p2 int = 21;
EXEC sp_execute_external_script
  @language = N'Java'
, @script = N'JavaTest1.adder'
, @params = N'@x int, @y int'
, @x = @p1
, @y = @p2   
GO
</code></pre>

<p><strong>Code Snippet 11:</strong> <em>Execute SQL Code with Parameters</em></p>

<p>As we see in <em>Code Snippet 11</em>, I have added the Java <code>x</code> and <code>y</code> class members to the <code>@params</code> parameter as SQL parameters: <code>@x</code> and <code>@y</code>. I then add the <code>@x</code> and <code>@y</code> parameters as named parameters, and assign them values from the declared parameters <code>@p1</code> and <code>@p2</code>. When I execute the code in <em>Code Snippet 11</em>, I see this:</p>

<p><img src="/images/posts/sql_2k19_java_intro_exec_params.png" alt="" /></p>

<p><strong>Figure 9:</strong> <em>Execution with Parameters</em></p>

<p>As we see in <em>Figure 9</em> it works and, outlined in red, we get the result printed out. Happy Times!</p>

<h2 id="summary">Summary</h2>

<p>In this post we saw how we install and enable the Java extensions for SQL Server 2019:</p>

<ul>
<li>On Windows you install them via the <em>Machine Learning Services</em> feature during setup or when adding features.</li>
<li>In Linux you install by installing the package: <code>mssql-server-extensibility-java</code>.</li>
<li>Unless the <code>external scripts enabled</code> configuration option is already enabled you need to enable it as in <em>Code Snippet 3</em>.</li>
<li>The Java supported version on both Windows and Linux is version 1.8.x (at least for CTP 2.1).</li>
<li>On Linux, when you install the <code>mssql-server-extensibility-java</code> package, the correct Java version gets installed if it is not on the box already.</li>
<li>On Windows, you have to install the correct version manually if it is not installed.</li>
<li>On Windows, the <code>Path</code> system environment variable needs to be extended to include the directory where <code>jvm.dll</code> exists.</li>
<li>It is good practice to create an environment variable called <code>CLASSPATH</code> which indicates where your compiled Java code exists.</li>
<li>On Windows you need to give <code>Read</code> permissions on the <code>CLASSPATH</code> directory to <code>ALL APPLICATION PACKAGES</code>.</li>
<li>On Linux you need to give <code>Read</code> and <code>Execute</code> permissions on the on the <code>CLASSPATH</code> directory to the <code>mssql_satellite</code> user.</li>
</ul>

<p>So, when the Java extensions are enabled we can write and execute Java code:</p>

<ul>
<li>We execute Java code from SQL Server using <code>sp_execute_external_script</code>.</li>
<li>We define the class and method we call in the <code>@script</code> parameter.</li>
<li>All methods called from SQL Server need to be <code>public static</code>.</li>
<li>The static methods can not have a return type, they need to be <code>public static void</code>.</li>
<li>The methods must be parameterless.</li>
<li>No support for output parameters.</li>
<li>The code needs to contain &ldquo;magic&rdquo; <code>public static</code> class members.</li>
<li>One such member is <code>numberOfOutputCols</code> which is always required. It has to be declared as: <code>public static short numberOfOutputCols;</code>.</li>
<li>Even though the methods must be parameterless we can pass in parameters as class members.</li>
<li>We refer to the class member parameters in SQL with the same name as the Java names but appended with <code>@</code>.</li>
<li>We define the SQL parameters in <code>sp_execute_external_script</code>&rsquo;s <code>@params</code> parameter.</li>
<li>We add the SQL parameters as named parameters in <code>sp_execute_external_script</code>.</li>
</ul>

<p>So far, the code we have used is very simple. In the next post we look at how we can return data to the caller, and how we pass data sets around.</p>

<h2 id="finally">~ Finally</h2>

<p>If you have comments, questions etc., please comment on this post or <a href="mailto:niels.it.berglund@gmail.com">ping</a> me.</p>
    <br/>
    
<h2>Blog Feed:</h2>
To automatically receive more posts like this, please
<a href="http://feeds.feedburner.com/manageddata/" target="_blank"> subscribe to my RSS/Atom feed</a> in your feed reader!</p>



  </div>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3005153158271538"
     data-ad-slot="1158080725"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  

<div class="post--navigation post--navigation-single">
    
    <a href="/2018/11/25/interesting-stuff---week-47/" class="post--navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Interesting Stuff - Week 47</span>
    </a>
    
    
    <a href="/2018/12/02/interesting-stuff---week-48/" class="post--navigation-next">
      <span class="navigation-tittle">Interesting Stuff - Week 48</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  


<div class="post__related">
    
    <h2>Related Articles</h2>
    <ul class="related-posts">
        
<li>
  <span class="list__title--small">
    <a href="/2018/09/29/sql-server-2019-for-linux-in-docker-on-windows/">SQL Server 2019 for Linux in Docker on Windows</a>
      
      <time class="pull-right hidden-tablet">Sep 29 &#39;18</time>
      
  </span>
</li>

<li>
  <span class="list__title--small">
    <a href="/2018/09/24/what-is-new-in-sql-server-2019-public-preview/">What is New in SQL Server 2019 Public Preview</a>
      
      <time class="pull-right hidden-tablet">Sep 24 &#39;18</time>
      
  </span>
</li>

<li>
  <span class="list__title--small">
    <a href="/2018/08/04/sp_execute_external_script-and-sql-compute-context---iii/">sp_execute_external_script and SQL Compute Context - III</a>
      
      <time class="pull-right hidden-tablet">Aug 04 &#39;18</time>
      
  </span>
</li>

<li>
  <span class="list__title--small">
    <a href="/2018/07/29/interesting-stuff---week-30/">Interesting Stuff - Week 30</a>
      
      <time class="pull-right hidden-tablet">Jul 29 &#39;18</time>
      
  </span>
</li>

<li>
  <span class="list__title--small">
    <a href="/2018/07/22/interesting-stuff---week-29/">Interesting Stuff - Week 29</a>
      
      <time class="pull-right hidden-tablet">Jul 22 &#39;18</time>
      
  </span>
</li>

    </ul>
</div>



  
    
        <div id="disqus_thread"></div>
<script type="text/javascript">
    

    (function () {
    if (location.hostname === "localhost" ||
      location.hostname === "127.0.0.1" ||
      location.hostname === "") {
      return;
    }
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    var disqus_shortname = 'manageddata';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || 
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<noscript>
  Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by
  <span class="logo-disqus">Disqus</span>
</a>

    


</article>


        </div>
        
    
  
  
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-18914734-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"
  integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy"
  crossorigin="anonymous">
</script>


<script src="/js/highlight.pack.js"></script>

<script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
</script>



    



    </body>
</html>
